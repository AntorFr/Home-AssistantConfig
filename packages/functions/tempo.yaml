template:
  - trigger:
      platform: time_pattern
      minutes: /30
    action:
    - service: calendar.list_events
      target:
        entity_id: calendar.rte_tempo_calendrier
      data:
        start_date_time: "{{ (now() + timedelta(days=1)).strftime('%Y-%m-%d 00:00:00') }}"
        duration:
          hours: 24
          minutes: 0
          seconds: 0
      response_variable: rte_next_day
    sensor:
    - name: Tempo - Couleur demain
      unique_id: rte_next_day
      state: "{{ (rte_next_day.events| first).summary if (rte_next_day.events | count) > 0  }}"
      attributes:
        description: "{{ rte_next_day.events| first).description if (rte_next_day.events | count) > 0 }}"
      icon: mdi:calendar

script:
###############################################
  on_off_tempo:
    alias: "on>off tempo"
    mode: parallel
    fields:
      minutes:
        name: Minutes
        description: "The amount of time to wait before turning off the device"
        required: true
        selector:
          number:
            min: 0
            max: 60
            step: 1
            unit_of_measurement: minutes
            mode: slider
      entity:
        name: Entity
        description: "Entity to be turned on>off"
        required: true
        selector:
            entity:
    sequence:
    - service: homeassistant.turn_on
      target:
        entity_id: "{{ entity }}"
    - delay: 
        minutes: "{{ minutes }}"
    - service: homeassistant.turn_off
      target:
        entity_id: "{{ entity }}"
###############################################