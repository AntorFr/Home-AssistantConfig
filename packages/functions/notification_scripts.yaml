script:
###############################################
  light_notify_red_alarm:
    alias: "Light Notify - Alarm"
    mode: parallel
    icon: mdi:alarm-light-outline
    fields:
      light_entities:
        name: Light entities
        description: List of light entities to be used
        required: true
    sequence:
      - service: light.turn_on
        data:
          color_name: red
          effect: breathe
          brightness_pct: 100
        target:
          entity_id: "{{light_entities}}"
      - service: number.set_value
        data:
          value: 60
        target:
          entity_id: >-
            {%- set ns = namespace(speed_entities=[]) %}

            {%- if light_entities is not none %}
              {%- set light_entities = iif(light_entities is string,[light_entities],light_entities) %}
              {%- for light_entity in light_entities %}
                {%- set speed_entitiy = device_entities(device_id(light_entity))|select('match','^number\..*')|list %}
                {%- set ns.speed_entities =  (ns.speed_entities+speed_entitiy)|unique|list%}
              {%- endfor %}
            {%- endif %}
            {{ns.speed_entities}}
###############################################
  light_notify_stop:
    alias: "Light Notify - Stop"
    icon: mdi:alarm-light-off-outline
    mode: parallel
    sequence:
      - service: light.turn_off
        target:
          entity_id: "{{light_entities}}"
###############################################
  sound_notify:
    alias: "Sound Notify"
    mode: parallel
    icon: mdi:alarm-light-outline
    fields:
      media_player_entities:
        name: Media player entities
        description: List of media player to be used
        required: true
      media_content_id:
        description: content id to be displayed
        required: true
    sequence:
      - service: media_player.play_media
        data:
          announce: true
          media_content_type: "music"
          media_content_id: "{{media_content_id}}"
        target:
          entity_id: "{{media_player_entities}}"
###############################################
  sonos_say:
    alias: "Sonos TTS script"
    sequence:
    - service: sonos.snapshot
      data_template:
        entity_id: "{{ sonos_entity }}"
    - service: media_player.unjoin
      data_template:
        entity_id: "{{ sonos_entity }}"
    - service: media_player.volume_set
      data_template:
        entity_id: "{{ sonos_entity }}"
        volume_level: "{{ volume }}"
    - service: tts.google_say
    #- service: tts.voicerss_say
      data_template:
        entity_id: "{{ sonos_entity }}"
        message: "{{ message }}"
    - delay: "{{ delay }}"
    - service: sonos.restore
      data_template:
        entity_id: "{{ sonos_entity }}"
###############################################

