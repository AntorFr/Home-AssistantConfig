binary_sensor:
  - platform: workday
    country: FR
    workdays: [mon, tue, wed, thu, fri]
    excludes: [sat, sun, holiday]

switch:
  - platform: template
    switches:
      night_mode:
        turn_on:
          service: script.routine_sleep_mode
          data: {}
        turn_off:
          service: script.routine_matin
          data: {}
        icon_template: >-
          {% if is_state('switch.night_mode', 'on') %}
            mdi:weather-night
          {% else %}
            mdi:weather-sunny
          {% endif %}
          

automation:
################################################################################
- id: 'evening'
  alias: Routine - Day - Soir√©e
  description: ''
  trigger:
  - platform: time
    at: '20:00:00'
  condition:
  - condition: state
    entity_id: binary_sensor.anyone_home
    state: 'on'
  action:
  - scene: scene.soiree
  mode: single
################################################################################

################################################################################
- id: 'morning'
  alias: Routine - Day - Matin
  description: 'Routine matin'
  trigger:
  - platform: time
    at: "08:30:00"
  condition:
      - condition: and
        conditions:
          - condition: state
            entity_id: binary_sensor.anyone_home
            state: 'on'
          - condition: state
            entity_id: switch.night_mode
            state: 'on'
          - condition: time
            after: '06:00:00'
            before: '18:00:00'
  action:
  - service: switch.turn_off
    target:
      entity_id: switch.night_mode
  mode: single
################################################################################

################################################################################
- id: 'night'
  alias: Routine - Day - Nuit
  description: ''
  trigger:
  - platform: time
    at: '03:00:00'
  condition:
      - condition: and
        conditions:
          - condition: state
            entity_id: binary_sensor.anyone_home
            state: 'on'
          - condition: state
            entity_id: switch.night_mode
            state: 'off'
          - condition: time
            after: '18:00:00'
            before: '06:00:00'
  action:
  - service: switch.turn_on
    target:
      entity_id: switch.night_mode
  mode: single
################################################################################